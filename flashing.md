# Прошивка

## Прошивка Zigbee модуля

Файл актуальной прошивки для своего модуля можно взять здесь:

- для модулей CC2652 [здесь](https://github.com/Koenkk/Z-Stack-firmware/releases)
- для модулей CC2530 - CC2538 [здесь](https://github.com/Koenkk/Z-Stack-firmware/tree/master/coordinator/Z-Stack_3.0.x/bin)

или [здесь](https://github.com/slsys/Gateway/tree/master/rom/)

Шлюз по официальным каналам поставляется с модулем `RFSTAR`, поэтому прошивку следует выбирать `CC1352P2_CC2652P_launchpad_*.zip` Для шлюза, собранного самостоятельно или купленного неофициально, с прошивкой следует определиться самостоятельно или спросить у продавца.

Готовый шлюз обычно поставляется с прошитым модулем.

Прошивка модуля возможна как по воздуху, так и программатором.

- о прошивке по воздуху рассказывается в этом [видео](https://www.youtube.com/watch?v=5VKNBCV6M4U)
- о прошивке программатором:
  - прошивка модулей [2538/2652](https://zigbee.wiki/books/прошивки/page/прошиваем-сс2538-с-помощью-j-link) программатором J-Link
  - прошивка модулей [2530](https://zigbee.wiki/books/прошивки/page/прошивка-cc2531cc2530) программатором CC-Debugger 

<!--

## Прошивка модуля CC2538

Первым делом после сборки модуля необходимо прошить модуль.
Скачать последнюю прошивку СС2538 можно [тут](https://github.com/slsys/Gateway/blob/master/rom/JH_2538_2592_ZNP_UART_20201010.hex). Готовый шлюз обычно поставляется с прошитым модулем. Более подробно информация разобрана в статье на сайте [modkam.ru](https://modkam.ru/?p=1188)

-->

## Прошивка микроконтроллера ESP32

Если на плате распаян модуль ch340e, то микроконтроллер ESP32 можно прошить с помощью обычного micro-USB кабеля. Правильно собранный шлюз c ch340e должен отображаться в системе как последовательный порт.

![](/img/boot.png)

## Порядок прошивки чистого шлюза или сброс ESP32 к первоначальному состоянию

1. Качаем последнюю full версию прошивки из [репозитория](https://github.com/slsys/Gateway/tree/master/rom), распаковываем архив. Файл `*_full.zip`
2. С нажатой кнопкой BOOT подключаем с помощью micro-USB кабеля шлюз к вашему ПК.
3. Запускаем пакетный файл сброса Clear.bat
4. На всякий случай перезагружаем шлюз по питанию и снова подключаем с нажатой кнопкой BOOT
5. Прошиваем шлюз с помощью пакетного файла Flash.bat
6. Перезагружаем шлюз и подключаемся к созданной им точке доступа ZGWxxx.
7. Настраиваем сеть WiFi и микроконтроллер по [инструкции](/firststart.md).

## Порядок обновления прошивки шлюза

1. Качаем последнюю full версию прошивки из [репозитория](https://github.com/slsys/Gateway/tree/master/rom), распаковываем архив. Файл `*_full.zip`
2. С нажатой кнопкой BOOT подключаем с помощью micro-USB кабеля шлюз к вашему ПК.
3. Прошиваем шлюз с помощью батника Update.bat

Если имеется более [новая прошивка](https://boosty.to/slsys), необходимо заменить ею старую. Файл `\firmware\firmware.bin` в архиве.

Замечание: существует две версии прошивки, для чипов с 4мб и 16 мб FLASH RAM. Версии отличаются наличием возможности производить обновление через OTA.
